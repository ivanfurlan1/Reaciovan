<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QESQ - Nueva Era (Fusionado)</title>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /*
        ==========================================================================
        CONFIGURACIÓN Y VARIABLES CSS (MODO OSCURO POR DEFECTO)
        ==========================================================================
        */
        :root {
            --color-background: #0A0A1A; /* Un azul casi negro muy profundo */
            --color-primary-orange: #FF4D00;
            --color-secondary-blue: #00A2FF;
            --color-accent-red: #E5005A;
            --color-text-light: #E0E0E0;
            --color-text-dark: #A0A0A0;
            --card-bg-color: rgba(22, 28, 51, 0.5); /* Azul oscuro semi-transparente */
            --card-border-color: rgba(60, 70, 110, 0.3);
            --blur-intensity: 12px;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --header-shadow-color: rgba(0,0,0,0.2);
        }

        /*
        ==========================================================================
        VARIABLES CSS PARA MODO CLARO
        ==========================================================================
        */
        body.light-mode {
            --color-background: #F0F2F5; /* Un gris muy claro y suave */
            --color-text-light: #1A202C; /* Texto oscuro principal */
            --color-text-dark: #5A6472; /* Texto oscuro secundario */
            --card-bg-color: rgba(255, 255, 255, 0.6); /* Blanco semi-transparente */
            --card-border-color: rgba(0, 0, 0, 0.1);
            --shadow-color: rgba(0, 0, 0, 0.25);
            --header-shadow-color: rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text-light);
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color 0.5s ease, color 0.5s ease;
            /* == MODIFICACIÓN CSS: Se deshabilita la selección de texto en todo el juego == */
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Aunque la selección está deshabilitada, dejamos el estilo por si se habilita en algún elemento específico */
        ::selection {
            background-color: var(--color-primary-orange);
            color: white;
        }

        /*
        ==========================================================================
        EFECTOS DE FONDO Y CONTENEDOR PRINCIPAL
        ==========================================================================
        */
        .main-container::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 15% 25%, var(--color-secondary-blue), transparent 30%),
                radial-gradient(circle at 85% 75%, var(--color-primary-orange), transparent 40%);
            opacity: 0.1;
            filter: blur(100px);
            z-index: -1;
            animation: background-lights 20s infinite alternate ease-in-out;
        }

        @keyframes background-lights {
            0% { transform: scale(1) translate(0, 0); }
            100% { transform: scale(1.2) translate(10px, -20px); }
        }

        .screen {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            transform: translateY(20px) scale(0.97); 
            pointer-events: none;
            transition: opacity 0.3s cubic-bezier(0.22, 1, 0.36, 1), transform 0.3s cubic-bezier(0.22, 1, 0.36, 1);
            will-change: transform, opacity; 
        }

        .screen.is-active {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }
        
        .screen.hidden {
            display: none;
        }

        /*
        ==========================================================================
        PANTALLA DE INICIO
        ==========================================================================
        */
        #start-screen h1 {
            font-weight: 900;
            font-size: clamp(3rem, 15vw, 8rem);
            letter-spacing: -0.05em;
            background-image: linear-gradient(45deg, var(--color-primary-orange), var(--color-accent-red));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: title-glow 5s infinite alternate, float-in 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        @keyframes float-in {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes title-glow {
            from { text-shadow: 0 0 10px rgba(255, 77, 0, 0.4); }
            to { text-shadow: 0 0 25px rgba(229, 0, 90, 0.6); }
        }
        
        body.light-mode #start-screen h1 {
            animation: float-in 1s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            text-shadow: none;
        }

        .btn-modern {
            position: relative;
            padding: 0.8rem 2.5rem;
            border: 1px solid var(--card-border-color);
            border-radius: 50px;
            background: var(--card-bg-color);
            backdrop-filter: blur(var(--blur-intensity));
            color: var(--color-text-light);
            font-weight: 600;
            font-size: 1.1rem;
            overflow: hidden;
            transition: color 0.4s, transform 0.2s, box-shadow 0.4s, background-color 0.4s;
            transform: scale(1);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            animation: fade-in-up 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        #start-button { animation-delay: 0.2s; }
        #how-to-play-button { animation-delay: 0.3s; }
        #theme-toggle-button { animation-delay: 0.4s; }


        @keyframes fade-in-up {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn-modern::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: radial-gradient(circle, var(--color-primary-orange) 0%, transparent 80%);
            border-radius: 50%;
            transition: width 0.6s, height 0.6s;
            transform: translate(-50%, -50%);
            opacity: 0;
            z-index: -1;
        }

        .btn-modern:hover {
            color: white;
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 77, 0, 0.3);
        }
        
        body.light-mode .btn-modern:hover {
            color: #fff;
        }
        
        body.light-mode #start-button:hover, body.light-mode #how-to-play-button:hover, body.light-mode #close-instructions-button:hover {
            color: #fff;
        }


        .btn-modern:hover::before {
            width: 300px;
            height: 300px;
            opacity: 0.6;
        }
        
        .btn-theme {
            padding: 0.8rem;
            width: 48px;
            height: 48px;
        }

        /*
        ==========================================================================
        PANTALLA DE REVELACIÓN DE PERSONAJE
        ==========================================================================
        */
        #character-reveal-screen h2 {
            font-weight: 700;
            font-size: clamp(1.5rem, 5vw, 3rem);
            text-shadow: 0 0 15px rgba(0, 162, 255, 0.3);
            color: var(--color-text-dark);
            opacity: 0;
            animation: fade-in-up 1s 0.2s forwards;
        }

        body.light-mode #character-reveal-screen h2 {
            text-shadow: none;
        }

        .revealed-card-container {
            perspective: 2000px;
            width: clamp(250px, 50vw, 320px);
            aspect-ratio: 4 / 5;
        }

        #revealed-character-card {
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            animation: reveal-animation 3s forwards cubic-bezier(0.22, 1, 0.36, 1);
            opacity: 0;
            transform: translateY(50px) rotateX(70deg) scale(0.8);
        }
        
        @keyframes reveal-animation {
            0% {
                opacity: 0;
                transform: translateY(50px) rotateX(70deg) scale(0.8);
            }
            60% {
                opacity: 1;
                transform: translateY(0) rotateX(0deg) scale(1.1);
            }
            100% {
                opacity: 1;
                transform: translateY(0) rotateX(0deg) scale(1);
            }
        }

        .revealed-card-inner {
            width: 100%; height: 100%;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px var(--shadow-color);
            position: relative;
        }

        .revealed-card-inner img {
            width: 100%; height: 100%;
            object-fit: cover;
        }

        .revealed-card-inner::before, .revealed-card-inner::after {
            content: '';
            position: absolute;
            inset: 0;
            z-index: 1;
            pointer-events: none;
        }

        .revealed-card-inner::before {
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
        }
        
        body.light-mode .revealed-card-inner::before {
             border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .revealed-card-inner::after {
            background: linear-gradient(160deg, rgba(255,255,255,0.2) 0%, transparent 30%);
            animation: card-glint 5s infinite ease-in-out;
        }

        @keyframes card-glint {
            0%, 100% { transform: translateX(-150%) translateY(-50%) rotate(45deg); }
            50% { transform: translateX(150%) translateY(50%) rotate(45deg); }
        }

        #revealed-character-name {
            font-size: 1.8rem;
            font-weight: 600;
            opacity: 0;
            animation: text-fade-in 1s 1.5s forwards;
            color: var(--color-text-light);
        }
        
        @keyframes text-fade-in {
            to { opacity: 1; }
        }

        /*
        ==========================================================================
        PANTALLA DE JUEGO
        ==========================================================================
        */
        #game-screen {
            justify-content: flex-start;
        }
        
        .board-header {
            width: 100%;
            max-width: 1200px;
            padding: 0.75rem 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            border-radius: 1rem;
            backdrop-filter: blur(var(--blur-intensity));
            box-shadow: 0 10px 30px var(--header-shadow-color);
            opacity: 0;
            transform: translateY(-20px);
            animation: header-fade-in 0.8s 0.2s forwards;
        }
        
        @keyframes header-fade-in {
          to { opacity: 1; transform: translateY(0); }
        }
        
        #your-character {
            width: 4rem; height: 4rem;
            border-radius: 50%;
            border: 2px solid var(--color-secondary-blue);
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 162, 255, 0.5), inset 0 0 5px var(--shadow-color);
            transition: transform 0.3s ease;
        }
        
        #your-character:hover {
            transform: scale(1.1);
        }
        
        #restart-button {
            background: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s, color 0.3s, border-color 0.3s, transform 0.2s, box-shadow 0.3s;
            color: var(--color-text-light);
        }

        #restart-button:hover {
            background: var(--color-accent-red);
            color: white;
            border-color: transparent;
            transform: scale(1.1) rotate(45deg);
            box-shadow: 0 0 20px rgba(229, 0, 90, 0.4);
        }
        
        #restart-button svg {
            transition: transform 0.3s;
        }
        
        #restart-button:hover svg {
             transform: rotate(-45deg);
        }
        
        body.light-mode #restart-button:hover {
            color: white;
        }

        #game-board {
            width: 100%;
            max-width: 1200px;
            perspective: 3000px;
        }

        .card-item {
            perspective: 1500px;
            transition: transform 0.3s ease;
        }

        .card-item:hover {
            transform: scale(1.05);
            z-index: 10;
        }

        .card-inner {
            position: relative;
            width: 100%; height: 100%;
            transition: transform 0.6s ease;
            transform-style: preserve-3d;
            border-radius: 0.75rem;
            box-shadow: 0 10px 20px var(--shadow-color);
        }

        .is-flipped .card-inner {
            transform: rotateX(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 0.75rem;
            overflow: hidden;
            border: 1px solid var(--card-border-color);
        }
        
        .card-front {
            background-color: var(--color-background);
        }
        
        .card-front img {
          filter: saturate(1.1);
          transition: filter 0.8s ease;
        }

        /* === MODIFICACIÓN CSS: INICIO === */
        /* Se unifica el efecto de la imagen al voltearse para ambos temas. */
        /* Ahora, tanto en modo oscuro como claro, la imagen se pondrá en escala de grises y con el mismo brillo. */
        .is-flipped .card-front img {
            filter: grayscale(1) brightness(0.8);
        }
        /* La regla específica para 'body.light-mode .is-flipped .card-front img' fue eliminada por ser redundante. */
        /* === MODIFICACIÓN CSS: FIN === */
        
        .card-name-overlay {
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            text-shadow: 0 1px 3px black;
            color: white;
        }
        
        body.light-mode .card-name-overlay {
            color: var(--color-text-light);
            background: linear-gradient(to top, rgba(255,255,255,0.8), transparent);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .card-back {
            background: var(--card-bg-color);
            backdrop-filter: blur(var(--blur-intensity));
            transform: rotateX(180deg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 2rem;
            letter-spacing: -0.05em;
            color: rgba(255, 255, 255, 0.4);
            text-shadow: 0 0 10px rgba(0, 162, 255, 0.2);
            position: relative;
        }
        
        body.light-mode .card-back {
            color: rgba(0, 0, 0, 0.4);
            text-shadow: none;
        }
        
        .card-pop-in {
            animation: card-pop-in-animation 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            opacity: 0;
            transform: scale(0.8) rotateY(20deg);
        }

        @keyframes card-pop-in-animation {
            to {
                opacity: 1;
                transform: scale(1) rotateY(0);
            }
        }
        
        /*
        ==========================================================================
        MODALES
        ==========================================================================
        */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(10, 10, 26, 0.7);
            backdrop-filter: blur(var(--blur-intensity));
            z-index: 100;
            opacity: 0;
            transition: opacity 0.4s ease-in-out, background-color 0.5s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        body.light-mode .modal-overlay {
            background-color: rgba(240, 242, 245, 0.7);
        }

        .modal-overlay.is-visible {
            opacity: 1;
        }
        
        .modal-content {
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.4s 0.1s ease-in-out, transform 0.4s 0.1s ease-in-out;
            background: var(--card-bg-color);
            border: 1px solid var(--card-border-color);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .is-visible .modal-content {
            opacity: 1;
            transform: scale(1);
        }
        
        .modal-content.enlarged-image-container {
            background: transparent;
            border: none;
            padding: 0;
            width: auto;
            max-width: fit-content;
            box-shadow: none;
            overflow-y: visible;
            cursor: grab;
        }

        .enlarged-image {
            max-width: 90vw;
            max-height: 80vh; 
            width: auto;
            height: auto;
            object-fit: contain;
            border-radius: 1rem;
            box-shadow: 0 20px 50px var(--shadow-color);
            border: 2px solid var(--card-border-color);
            pointer-events: none;
        }
        
        #confirm-restart-button:hover::before {
             background: radial-gradient(circle, var(--color-accent-red) 0%, transparent 80%);
        }
        #confirm-restart-button:hover {
            box-shadow: 0 0 30px rgba(229, 0, 90, 0.4);
        }

    </style>
</head>
<body class="overflow-hidden light-mode">

    <div class="main-container w-full min-h-screen relative">

        <!-- Pantalla de Inicio -->
        <div id="start-screen" class="screen is-active">
            <div class="flex flex-col items-center justify-center space-y-8">
                <h1 class="text-center">QESQ</h1>
                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <button id="start-button" class="btn-modern">Iniciar Juego</button>
                    <button id="how-to-play-button" class="btn-modern">Cómo Jugar</button>
                </div>
            </div>
            <!-- MODIFICACIÓN: Se cambió "bottom-8" por "bottom-12" para subir el botón -->
            <div class="absolute bottom-12 w-full flex justify-center">
                <button id="theme-toggle-button" class="btn-modern btn-theme" aria-label="Cambiar tema">
                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class=""><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                </button>
            </div>
        </div>

        <!-- Pantalla de Animación del Personaje -->
        <div id="character-reveal-screen" class="screen hidden space-y-6 text-center">
            <h2 class="">Tu personaje es...</h2>
            <div class="revealed-card-container">
                <div id="revealed-character-card">
                    <div class="revealed-card-inner">
                        <img id="revealed-character-img" src="" alt="Tu Personaje">
                    </div>
                </div>
            </div>
            <p id="revealed-character-name" class=""></p>
        </div>

        <!-- Pantalla de Juego -->
        <div id="game-screen" class="screen hidden py-10">
            <header class="board-header">
                <button id="restart-button" title="Reiniciar Juego">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                      <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2z"/>
                      <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466"/>
                    </svg>
                </button>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <p class="text-xs" style="color: var(--color-text-dark)">Tu personaje</p>
                        <h3 id="your-character-name" class="text-md sm:text-lg font-semibold" style="color: var(--color-text-light);"></h3>
                    </div>
                    <div id="your-character" class="cursor-pointer">
                        <img id="your-character-img" src="" alt="Tu Personaje Secreto" class="w-full h-full object-cover">
                    </div>
                </div>
            </header>
            
            <div id="game-board" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-3 md:gap-4">
                <!-- Las cartas se generan dinámicamente -->
            </div>
        </div>

    </div>

    <!-- Modal para agrandar la imagen -->
    <div id="enlarged-character-modal" class="modal-overlay hidden">
        <div class="modal-content enlarged-image-container flex flex-col items-center gap-4">
            <img id="enlarged-character-img" src="" alt="Personaje agrandado" class="enlarged-image">
            <p id="enlarged-character-name" class="text-2xl font-bold" style="color: var(--color-text-light); text-shadow: 0 2px 4px var(--shadow-color);"></p>
        </div>
    </div>
    
    <!-- Modal para las Instrucciones -->
    <div id="instructions-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-2xl font-bold mb-6 text-center" style="color: var(--color-text-light);">Cómo Jugar</h2>
            <div class="space-y-4 text-lg" style="color: var(--color-text-dark);">
                <p>El objetivo es descubrir el personaje secreto de tu oponente antes de que él descubra el tuyo.</p>
                <p>Por turnos, haz preguntas de "sí" o "no" sobre las características de los personajes. Usa las respuestas para descartar opciones en tu tablero haciendo clic en ellas.</p>
                <p>Por ejemplo: "¿Tu personaje usa gorro?". Si la respuesta es "sí", descartas a todos los que no lo usan.</p>
                <p>¡El primero en adivinar correctamente el personaje del rival, gana!</p>
            </div>
            <div class="flex justify-center mt-8">
                <button id="close-instructions-button" class="btn-modern">Entendido</button>
            </div>
        </div>
    </div>
    
    <div id="restart-confirm-modal" class="modal-overlay hidden">
        <div class="modal-content text-center">
            <h2 class="text-2xl font-bold mb-4" style="color: var(--color-text-light);">¿Reiniciar el juego?</h2>
            <p class="text-lg mb-8" style="color: var(--color-text-dark);">
                Si continúas, volverás a la pantalla de inicio y perderás tu personaje actual.
            </p>
            <div class="flex justify-center gap-4">
                <button id="cancel-restart-button" class="btn-modern">Cancelar</button>
                <button id="confirm-restart-button" class="btn-modern">Reiniciar</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // =========================================================================
            //  BASE DE DATOS DE PERSONAJES
            // =========================================================================
            const characters = [
                { name: "Renata", imgUrl: "https://i.imgur.com/f8gRf26.png" },
                { name: "Hugo", imgUrl: "https://i.imgur.com/o61ttUd.png" },
                { name: "Florencio", imgUrl: "https://i.imgur.com/kToYUyO.png" },
                { name: "Mirtha", imgUrl: "https://i.imgur.com/Yx9HpwM.png" },
                { name: "Bautista", imgUrl: "https://i.imgur.com/rhlMOpw.png" },
                { name: "Valentina", imgUrl: "https://i.imgur.com/Ery2KqM.png" },
                { name: "Tiago", imgUrl: "https://i.imgur.com/B93Z0Wx.png" },
                { name: "Rosina", imgUrl: "https://i.imgur.com/Kcmi5SA.png" },
                { name: "Claudio", imgUrl: "https://i.imgur.com/xN8yCVY.png" },
                { name: "Julia", imgUrl: "https://i.imgur.com/nu7Q0rE.png" },
                { name: "Fernanda", imgUrl: "https://i.imgur.com/sx46oPW.png" },
                { name: "Francisco", imgUrl: "https://i.imgur.com/8v7nbch.png" },
                { name: "Alex", imgUrl: "https://i.imgur.com/cPHEruJ.png" },
                { name: "Micaela", imgUrl: "https://i.imgur.com/pGtnB0X.png" },
                { name: "Pedro", imgUrl: "https://i.imgur.com/hqJ9KIF.png" },
                { name: "Martín", imgUrl: "https://i.imgur.com/2jsnfpG.png" },
                { name: "Rosa", imgUrl: "https://i.imgur.com/KyHmOrb.png" },
                { name: "Raul", imgUrl: "https://i.imgur.com/kLbw0sC.png" },
                { name: "Sofía", imgUrl: "https://i.imgur.com/hpEd1N8.png" },
                { name: "Macarena", imgUrl: "https://i.imgur.com/AztpmjA.png" },
                { name: "Fabián", imgUrl: "https://i.imgur.com/HhFyDrw.png" },
                { name: "Catalina", imgUrl: "https://i.imgur.com/5pYKrOr.png" },
                { name: "Juan", imgUrl: "https://i.imgur.com/7Ila1Gq.png" },
                { name: "Sol", imgUrl: "https://i.imgur.com/2XQJQ8k.jpeg" }
            ];

            // =========================================================================
            //  REFERENCIAS A ELEMENTOS DEL DOM
            // =========================================================================
            const body = document.body;
            const startButton = document.getElementById('start-button');
            const restartButton = document.getElementById('restart-button');
            const gameBoard = document.getElementById('game-board');
            const enlargedCharacterModal = document.getElementById('enlarged-character-modal');
            const enlargedCharacterImg = document.getElementById('enlarged-character-img');
            const enlargedCharacterName = document.getElementById('enlarged-character-name'); 
            const howToPlayButton = document.getElementById('how-to-play-button');
            const instructionsModal = document.getElementById('instructions-modal');
            const closeInstructionsButton = document.getElementById('close-instructions-button');
            const themeToggleButton = document.getElementById('theme-toggle-button');
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            const restartConfirmModal = document.getElementById('restart-confirm-modal');
            const cancelRestartButton = document.getElementById('cancel-restart-button');
            const confirmRestartButton = document.getElementById('confirm-restart-button');
            
            // =========================================================================
            //  ESTADO DEL JUEGO
            // =========================================================================
            let yourSecretCharacter = null;
            
            function switchScreen(toScreenId) {
                const toScreen = document.getElementById(toScreenId);
                const fromScreen = document.querySelector('.screen.is-active');

                body.classList.add('overflow-hidden');

                if (fromScreen && fromScreen !== toScreen) {
                    fromScreen.classList.remove('is-active');

                    setTimeout(() => {
                        fromScreen.classList.add('hidden');
                        
                        toScreen.classList.remove('hidden');
                        
                        requestAnimationFrame(() => {
                            toScreen.classList.add('is-active');
                        });

                    }, 300);
                } else if (!fromScreen) {
                    toScreen.classList.remove('hidden');
                    toScreen.classList.add('is-active');
                }
            }


            // =========================================================================
            //  FUNCIONES PRINCIPALES DEL JUEGO
            // =========================================================================

            function createBoard() {
                gameBoard.innerHTML = ''; 

                const cardsHTML = characters.map((character, index) => `
                    <div class="card-item w-full aspect-[4/5] cursor-pointer group">
                        <div class="card-inner">
                            <div class="card-front">
                                <img src="${character.imgUrl}" alt="${character.name}" class="w-full h-full object-cover rounded-md" draggable="false">
                                <div class="card-name-overlay absolute bottom-0 left-0 right-0 p-2 text-center">
                                    <p class="font-semibold text-sm truncate">${character.name}</p>
                                </div>
                            </div>
                            <div class="card-back">
                                <span>QESQ</span>
                                <!-- MODIFICACIÓN: Se eliminó el <span> que mostraba el número (index + 1) -->
                            </div>
                        </div>
                    </div>
                `).join('');

                gameBoard.innerHTML = cardsHTML;

                const cards = gameBoard.querySelectorAll('.card-item');
                cards.forEach((cardElement, index) => {
                    const character = characters[index]; 
                    
                    // == MODIFICACIÓN JS: Se mueven los listeners de 'imgElement' a 'cardElement' ==
                    // Esto asegura que la interacción de mantener presionado funcione en toda la tarjeta,
                    // incluyendo el nombre del personaje.
                    
                    cardElement.addEventListener('click', () => {
                        cardElement.classList.toggle('is-flipped');
                    });
                    
                    cardElement.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        showImageModal(character.imgUrl, character.name);
                    });

                    let pressTimer;
                    cardElement.addEventListener('touchstart', (e) => {
                        // Solo prevenimos la acción por defecto si el temporizador se completa.
                        pressTimer = setTimeout(() => {
                            e.preventDefault();
                            showImageModal(character.imgUrl, character.name);
                        }, 500); 
                    }, { passive: true }); // Usamos passive: true para mejorar el scroll si no es un long-press

                    cardElement.addEventListener('touchend', () => {
                        clearTimeout(pressTimer);
                    });
                     cardElement.addEventListener('touchmove', () => {
                        clearTimeout(pressTimer);
                    });

                    setTimeout(() => {
                        cardElement.classList.add('card-pop-in');
                    }, index * 40);
                });
            }

            function handleGameStart() {
                yourSecretCharacter = characters[Math.floor(Math.random() * characters.length)];

                switchScreen('character-reveal-screen');
                
                const revealedCharacterImg = document.getElementById('revealed-character-img');
                const revealedCharacterName = document.getElementById('revealed-character-name');
                revealedCharacterImg.src = yourSecretCharacter.imgUrl;
                revealedCharacterImg.alt = `Tu Personaje: ${yourSecretCharacter.name}`;
                revealedCharacterName.textContent = yourSecretCharacter.name;

                setTimeout(() => {
                    showGameScreen();
                }, 4000);
            }
            
            function showGameScreen() {
                switchScreen('game-screen');
                body.classList.remove('overflow-hidden');
                
                const yourCharacterImg = document.getElementById('your-character-img');
                const yourCharacterName = document.getElementById('your-character-name');
                yourCharacterImg.src = yourSecretCharacter.imgUrl;
                yourCharacterImg.alt = `Tu Personaje Secreto: ${yourSecretCharacter.name}`;
                yourCharacterName.textContent = yourSecretCharacter.name;

                createBoard();
            }

            function restartGame() {
                switchScreen('start-screen');
            }

            // =========================================================================
            //  MANEJO DE MODALES Y LÓGICA DE DESLIZAR
            // =========================================================================
            
            const enlargedImageContainer = enlargedCharacterModal.querySelector('.modal-content');
            let isDragging = false, hasDragged = false;
            let startX = 0, startY = 0;

            function showModal(modalElement) {
                modalElement.classList.remove('hidden');
                setTimeout(() => modalElement.classList.add('is-visible'), 10);
            }
            
            function hideModal(modalElement) {
                modalElement.classList.remove('is-visible');
                setTimeout(() => {
                    modalElement.classList.add('hidden');
                    if (modalElement.id === 'enlarged-character-modal') {
                        enlargedImageContainer.style.transition = '';
                        enlargedImageContainer.style.transform = '';
                        enlargedImageContainer.style.opacity = '';
                    }
                }, 400);
            }

            function showImageModal(imgSrc, name) {
                enlargedCharacterImg.src = imgSrc;
                enlargedCharacterName.textContent = name;
                
                enlargedImageContainer.style.transition = 'none';
                enlargedImageContainer.style.transform = '';
                enlargedImageContainer.style.opacity = '';

                showModal(enlargedCharacterModal);
            }
            
            // --- Funciones para deslizar la tarjeta ---
            
            const dragStart = (e) => {
                if (e.target.tagName === 'P') return;

                isDragging = true;
                startX = e.pageX || e.touches[0].pageX;
                startY = e.pageY || e.touches[0].pageY;
                hasDragged = false;
                enlargedImageContainer.style.transition = 'none';
                enlargedImageContainer.style.cursor = 'grabbing';
            };

            const dragMove = (e) => {
                if (!isDragging) return;

                const currentX = e.pageX || e.touches[0].pageX;
                const currentY = e.pageY || e.touches[0].pageY;
                const deltaX = currentX - startX;
                const deltaY = currentY - startY;

                if (!hasDragged && (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5)) {
                   hasDragged = true;
                }
                
                if (hasDragged) {
                    e.preventDefault();
                    const rotation = deltaX * 0.1;
                    enlargedImageContainer.style.transform = `translate(${deltaX}px, ${deltaY}px) rotate(${rotation}deg)`;
                }
            };

            const dragEnd = (e) => {
                if (!isDragging) return;
                isDragging = false;
                enlargedImageContainer.style.cursor = 'grab';
                
                if (hasDragged) {
                    const currentX = e.pageX || e.changedTouches[0].pageX;
                    const currentY = e.pageY || e.changedTouches[0].pageY;
                    const deltaX = currentX - startX;
                    const deltaY = currentY - startY;
                    const swipeThreshold = 30; 

                    enlargedImageContainer.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';

                    if (Math.abs(deltaX) > swipeThreshold || Math.abs(deltaY) > swipeThreshold) {
                        let endX, endY;

                        if (Math.abs(deltaX) > Math.abs(deltaY)) {
                            endX = deltaX > 0 ? window.innerWidth : -window.innerWidth;
                            endY = deltaY;
                        } else {
                            endY = deltaY > 0 ? window.innerHeight : -window.innerHeight;
                            endX = deltaX;
                        }
                        
                        enlargedImageContainer.style.transform = `translate(${endX}px, ${endY}px) rotate(${deltaX * 0.2}deg)`;
                        enlargedImageContainer.style.opacity = '0';
                        
                        setTimeout(() => hideModal(enlargedCharacterModal), 50);
                    } else {
                        enlargedImageContainer.style.transform = 'translate(0, 0) rotate(0deg)';
                    }
                }
            };

            // =========================================================================
            //  EVENT LISTENERS
            // =========================================================================
            startButton.addEventListener('click', handleGameStart);
            
            restartButton.addEventListener('click', () => {
                showModal(restartConfirmModal);
            });
            
            cancelRestartButton.addEventListener('click', () => {
                hideModal(restartConfirmModal);
            });
            
            confirmRestartButton.addEventListener('click', () => {
                hideModal(restartConfirmModal);
                setTimeout(restartGame, 100); 
            });

            howToPlayButton.addEventListener('click', () => showModal(instructionsModal));
            closeInstructionsButton.addEventListener('click', () => hideModal(instructionsModal));
            
            themeToggleButton.addEventListener('click', () => {
                body.classList.toggle('light-mode');
                sunIcon.classList.toggle('hidden');
                moonIcon.classList.toggle('hidden');
            });

            document.getElementById('your-character').addEventListener('click', () => showImageModal(yourSecretCharacter.imgUrl, yourSecretCharacter.name));
            
            enlargedCharacterModal.addEventListener('click', () => {
                if (!hasDragged) {
                    hideModal(enlargedCharacterModal);
                }
            });

            enlargedImageContainer.addEventListener('mousedown', dragStart);
            enlargedImageContainer.addEventListener('touchstart', dragStart, { passive: false });

            window.addEventListener('mousemove', dragMove);
            window.addEventListener('touchmove', dragMove, { passive: false });

            window.addEventListener('mouseup', dragEnd);
            window.addEventListener('touchend', dragEnd);
            
            [instructionsModal, restartConfirmModal].forEach(modal => {
                 modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        hideModal(modal);
                    }
                });
            });

        });
    </script>
</body>
</html>
